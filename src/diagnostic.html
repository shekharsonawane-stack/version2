<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Diagnostic Test - Vision Studio</title>
    <style>
      body {
        font-family: system-ui, -apple-system, sans-serif;
        max-width: 800px;
        margin: 40px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .test {
        background: white;
        padding: 20px;
        margin: 10px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .pass { border-left: 4px solid #22c55e; }
      .fail { border-left: 4px solid #ef4444; }
      .status { font-weight: bold; margin-bottom: 10px; }
      .pass .status { color: #22c55e; }
      .fail .status { color: #ef4444; }
      pre {
        background: #f5f5f5;
        padding: 10px;
        border-radius: 4px;
        overflow-x: auto;
      }
      button {
        background: #1c1917;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        margin: 10px 10px 10px 0;
      }
      button:hover {
        background: #292524;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ” Vision Studio - Deployment Diagnostic</h1>
    <p>This page will help diagnose what's broken on your site.</p>
    
    <div id="results"></div>
    
    <button onclick="copyResults()">ğŸ“‹ Copy All Results</button>
    <button onclick="window.location.href='/'">ğŸ  Go to Main Site</button>

    <script type="module">
      const results = [];
      const container = document.getElementById('results');

      function addTest(name, passed, details) {
        results.push({ name, passed, details });
        
        const div = document.createElement('div');
        div.className = `test ${passed ? 'pass' : 'fail'}`;
        div.innerHTML = `
          <div class="status">${passed ? 'âœ… PASS' : 'âŒ FAIL'}: ${name}</div>
          <pre>${details}</pre>
        `;
        container.appendChild(div);
      }

      // Test 1: Check if we can load modules
      try {
        addTest('Module System', true, 'ES Modules are working');
      } catch (e) {
        addTest('Module System', false, e.toString());
      }

      // Test 2: Check if React loads
      try {
        const React = await import('react');
        addTest('React Library', true, `React version: ${React.version}`);
      } catch (e) {
        addTest('React Library', false, e.toString());
      }

      // Test 3: Check if main App loads
      try {
        const { default: App } = await import('./App.tsx');
        addTest('App.tsx Import', true, 'Main app file loaded successfully');
      } catch (e) {
        addTest('App.tsx Import', false, e.toString());
      }

      // Test 4: Check if CSS loads
      try {
        await import('./styles/globals.css');
        addTest('CSS Import', true, 'globals.css loaded');
        
        // Check if CSS is actually applied
        const computedStyle = window.getComputedStyle(document.body);
        const bgColor = computedStyle.backgroundColor;
        addTest('CSS Application', bgColor !== 'rgba(0, 0, 0, 0)', `Body background: ${bgColor}`);
      } catch (e) {
        addTest('CSS Import', false, e.toString());
      }

      // Test 5: Check if Tailwind is working
      const testDiv = document.createElement('div');
      testDiv.className = 'bg-red-500 text-white p-4';
      testDiv.style.display = 'none';
      document.body.appendChild(testDiv);
      const tailwindStyle = window.getComputedStyle(testDiv);
      const hasBgColor = tailwindStyle.backgroundColor === 'rgb(239, 68, 68)';
      addTest('Tailwind CSS', hasBgColor, 
        hasBgColor ? 'Tailwind classes are working' : `Expected red bg, got: ${tailwindStyle.backgroundColor}`
      );
      document.body.removeChild(testDiv);

      // Test 6: Check Supabase connection
      try {
        const { projectId, publicAnonKey } = await import('./utils/supabase/info.tsx');
        addTest('Supabase Config', !!(projectId && publicAnonKey), 
          `Project ID: ${projectId ? 'Present' : 'Missing'}, Key: ${publicAnonKey ? 'Present' : 'Missing'}`
        );
      } catch (e) {
        addTest('Supabase Config', false, e.toString());
      }

      // Test 7: Check if components load
      try {
        await import('./components/Header.tsx');
        await import('./components/Footer.tsx');
        await import('./components/ProductCard.tsx');
        addTest('Core Components', true, 'Header, Footer, ProductCard loaded');
      } catch (e) {
        addTest('Core Components', false, e.toString());
      }

      // Test 8: Check PostCSS config
      try {
        const response = await fetch('/postcss.config.js');
        const hasPostCSS = response.ok;
        addTest('PostCSS Config', hasPostCSS, 
          hasPostCSS ? 'postcss.config.js is accessible' : 'postcss.config.js not found'
        );
      } catch (e) {
        addTest('PostCSS Config', false, e.toString());
      }

      // Add summary
      const passed = results.filter(r => r.passed).length;
      const total = results.length;
      const summary = document.createElement('div');
      summary.className = `test ${passed === total ? 'pass' : 'fail'}`;
      summary.innerHTML = `
        <div class="status">ğŸ“Š Summary: ${passed}/${total} tests passed</div>
        <pre>${passed === total ? 
          'All tests passed! The setup is correct.' : 
          'Some tests failed. See details above.'
        }</pre>
      `;
      container.appendChild(summary);

      // Make results available globally
      window.diagnosticResults = results;
      window.copyResults = function() {
        const text = results.map(r => 
          `${r.passed ? 'âœ…' : 'âŒ'} ${r.name}\n${r.details}\n`
        ).join('\n');
        navigator.clipboard.writeText(text).then(() => {
          alert('Results copied to clipboard!');
        });
      };
    </script>
  </body>
</html>
